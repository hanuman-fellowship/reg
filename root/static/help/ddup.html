<html>
<head>
<link rel="stylesheet" type="text/css" href="help.css" />
<style>
.code {
    color: red;
    font-family: Courier;
}
pre {
    margin-left: .5in;
    color: green;
}
li {
    margin-top: 5mm;
}
</style>
</head>
<body>
<h2>Distributed Demographic Update</h2>
This document describes a mechanism within Reg that
makes it very easy to keep everyone's address, email, phone numbers,
et cetera up to date.  This is done by requesting that people to do it <i>themselves</i>.
This <u>distributes</u> the clerical burden of our staff and reduces the risk
of typos and errors.
<ol>
<li>The process (nicknamed DDUP) is begun by Adding a Report (Listings &gt; People &gt; General Reports)
with a format of type:
<span class=code>Email, Code</span>
or
<span class=code>To CMS - Address, Code</span>.
<p>
<span class=code>Email, Code</span> is used
for making the requests by email.  The report output
contains the following fields:
First, Last, Email, Secure Code
<p>
<span class=code>To CMS - Address, Code</span> is used
when sending requests by snail mail.  The report output includes these fields:
First, Last, Address 1, Address 2, City, State, Zip, Country, Secure Code.
<b>Note</b>: Since this format is used for snail mail addresses it will only
include people <b>without</b> an email address.
<p>
The other attributes of the Report are up to you.
You can select a subset of all people by restricting
the zip code, the affiliations,
and/or the date of last contact.
People who are Inactive will not be included in the report's output.
Also note that there is no restriction based on
the people's mailing preferences - since this is a request
for them to update those preferences.
<li>
You can ask for a Count of the report to see if it is of the size you wish.
<p>
When you wish to Run these reports you will need to supply
an Expiration Date (in the usual format: see <a href=dates.html>Dates</a>).
<p>
<b>Important</b>: The output of the reports should be saved in a file for sending
to the mailing services (Mail Chimp and CMS).
Use 'File > Save As' in your browser.
<p>
The act of running the report will export/upload all the demographic data for
the chosen people
to a secure place on mountmadonna.org.  You will receive an email
about the status of the upload (hopefully it will say Success).
<li>
On the Listings > People > General Reports page
(might as well make a bookmark for this page, eh?) at the top you will see
a box with this information:
<pre>
Distributed Demographic Update
Import New   See Log  Clobber
Expires Jun 25
2 viewed, 4 changed - imported 20 of 223 = 8%
</pre>
This status line shows what has been happening.
<p>
Viewed - the # of people who clicked on the link but made no change.<br>
Changed -  the # of people who made some kind of change.<br>
Imported - How many people's changes have been imported so far?
The percentage is calculated as well so you can see what level
of feedback you're getting from the requests for demographic updates.
<p>
'Import New', 'See Log', and 'Clobber' are links. 
<p>
'See Log' will show you a timestamped log (in reverse chronological order)
of what has happened with the DDUP process.  You'll see when the exports
(uploadings) happened,
exactly what changes people made, what imports (see below) happened,
and when the DDUP process was 'clobbered'.
On that page you can choose 'Clear Log' to
start fresh.  There's also 'Reports' to go back to the list of reports.
<p>
'Import New' will take all the latest changes that were made
on mountmadonna.org and import them into Reg.  This act is logged.
You can do this import incrementally several times.
<p>
'Clobber' will (after confirmation) remove all traces of the current DDUP
report.   You can then run a different one.  This clobbering will
not be permitted if there are any outstanding changes that have
not yet been imported.
<p>
Once the expiration date has passed people will no longer
be able to update their information.  They'll get a page saying 'sorry ...'.
These people will have their records marked as having tried
to update their data.  When you are viewing the status of the DDUP
and seeing '# viewed, # changed, ...' there will also be
'# expired'.
<pre>
Distributed Demographic Update
Import New   See Log  Clobber
Expires Jun 25
2 <span style="color: blue">expired</span>, 2 viewed, 4 changed - imported 20 of 223 = 8%
</pre>

The word 'expired' is a link and you
can click it to see the names, email, and phone number (cell, home, or work)
of the people that tried to update their data after the
expiration date.  You can contact them if you wish to see
what they would have done.
<p>
At this point - the expiration date has passed - you
can do 'Import New' one last time and then 'Clobber' the DDUP process.
This will clear the data from mountmadonna.org.
<p>
There is an expiration date for two reasons:
<ol type=a>
<li>A deadline will prompt people to do it <i>now</i> rather than later.
<li>For security/privacy reasons it is good to have the people's
demographic data on the web (inaccessible though it may be) for
as little time as possible.
</ol>
<li>
Using Mail Chimp (for <span class=code>Email, Code</span> or Complete Mailing Service for <span class=code>To CMS - Address, Code</span>) you take the saved
report file and do a mail merge.    The body of the emails you send
should be something like this:
<pre>
Greetings FIRST,

MMC wants to be sure we have your current information
such as address, phone, mailing preferences, etc.
Click &lt;a href='https://www.mountmadonna.org/cgi-bin/update?code=CODE'&gt;here&lt;/a&gt; to see and update it.

Thank you,
MMC
</pre>
Your email will be worded much better, of course.
The Secure Code field in your saved data file will be used for the CODE above.
<li>
The people who receive the email will click on the link
and see their information.  They can change these things:
<p>
First, Last, Address 1, Address 2, City, State, Zip, Country.
Email address.  Sex (gender). Cell, Home, and Work phone numbers.
<p>
There is a section entitled 'Your Interests' which includes
the affiliations that begin (in Reg) with 'PROGRAMS -'.  The
'PROGRAMS -' prefix will be removed so the person will only see the rest of the
affiliation name.
This list is currently (6/25/17) like so:
<pre>
Art 
Ayurveda, Herbs & Health
Buddhist
Jewish
Meditation
Men's Programs
Movement  
Music
Personal Growth
Personal Retreats
Women's Programs
Yoga
Yoga Teacher Training
</pre>
<p>
The mailing preferences section looks like this:
<pre>
_ Send me brochures and cards via US Mail.
_ Send me emails.
_ You may share my address with MMC affiliates.
</pre>
<p>
After checking and updating any or all of this
the person will click on one of two buttons:
<pre>
1 - Submit the changes I made

2 - No changes are needed - It all looks Just Fine.
</pre>
In the first case we present a summary of what
their information looks like now and we give them
an opportunity to 'Re-Edit' it.   Or they can choose 'Looks Good'
which takes them to the home page of MMC.
<p>
The second case is Just Fine and they're again taken directly to the MMC home page.
<li>
If a nefarious hacker tries to break our system we
have some protections built in.  If the cgi-bin/update program
detects an illegal CODE it will give an error message and keep
track of who submitted it.  If too many failures have
happened (currently more than 5)
an email is sent to jonb@logicalpoetry.com (who else?)
and the person is notified
of their transgressions and they are BLOCKED (for 5 minutes).
<p>
This system can be tweaked as needed.
<li>
When the expiration date has passed people will no longer
be able to update their demographic data.  At this point we
can go to the Reports list page and choose 'Clobber'.
Then you can Run another one.
<p>
When a DDUP report has not yet expired and is currently active
you can go to another 'Email, Code' or 'Address, Code' report.
Instead of 'Run Report' the button at the bottom will
say 'Run Report and Append to Current DDUP'.
On choosing this, the report will be run and the records
so generated will be <i>appended</i> to
those that were exported before.  The expiration
date will be the same as the currently active one.
<li>
For DDUP reports that use <span class=code>Address, Code</span>
you can have CMS put the CODE on the mailing label somewhere.
Within the text of the mailing item (brochure, flyer, card, etc)
you can direct people to go to this web address:
<pre>
    <a target=_blank href='https://www.mountmadonna.org/update'>mountmadonna.org/update</a>
</pre>
At this site (click it above to see) you can enter your CODE
and proceed as before.
<p>
Again, note that when using the format <span class=code>To CMS - Address, Code</span>
the only people included in the report are those <b>without</b> an email address.
Using <span class=code>Email, Code</span> is <i>so</i> much 
more convenient for everyone that it should be used in preference
to <span class=code>To CMS - Address, Code</span>.
<p>
The page presented above needs styling attention - as do the other pages as well!.
The other pages are in the cgi-bin directory and are named
update.tt2, update2.tt2, update_msg.tt2, and update_expired.tt2.
They are not generated by Craft (yet).
</ol>
</body>
</html>
